<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Training ANN Model – Coffee Dataset</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0"></script>
</head>
<body style="font-family: Arial; padding:20px">
<h1>Training ANN Model – Coffee Dataset</h1>

<button onclick="startTraining()"> Lancer l’entraînement</button>

<pre id="log" style="background:#eee; padding:10px; margin-top:20px;"></pre>

<button onclick="downloadModel()"> Télécharger le modèle</button>

<script>
let model;

async function startTraining() {
    const log = document.getElementById("log");
    log.textContent = " Chargement du dataset…\n";

    const dataset = await fetch("dataset.csv").then(r => r.text());
    const lines = dataset.trim().split("\n");

    const X = [];
    const y = [];

    for (let i = 1; i < lines.length; i++) {
        const row = lines[i].split(",");

        const age = Number(row[1]);
        const gender = row[2].trim() === "Male" ? 1 : 0;
        const caffeine = Number(row[5]);
        const sleepHours = Number(row[6]);

        X.push([age, gender, caffeine]);
        y.push([sleepHours]);
    }

    const xs = tf.tensor2d(X);
    const ys = tf.tensor2d(y);

    log.textContent += ` Dataset chargé (${X.length} lignes)\n\n`;
    log.textContent += "Construction du modèle ANN…\n";

    model = tf.sequential();
    model.add(tf.layers.dense({ units: 32, activation: 'relu', inputShape: [3] }));
    model.add(tf.layers.dense({ units: 16, activation: 'relu' }));
    model.add(tf.layers.dense({ units: 1 }));

    model.compile({ optimizer: 'adam', loss: 'meanSquaredError' });

    log.textContent += " Entraînement…\n\n";

    await model.fit(xs, ys, {
        epochs: 30,
        batchSize: 32,
        callbacks: {
            onEpochEnd: (epoch, logs) => {
                log.textContent += `Epoch ${epoch + 1}: loss = ${logs.loss}\n`;
            },
            onTrainEnd: () => {
                log.textContent += "\n Modèle entraîné avec succès !\n";
            }
        }
    });
}

async function downloadModel() {
    if (!model) return alert("Entraîne d'abord !");
    await model.save("downloads://coffee_model");
}
</script>
</body>
</html>
